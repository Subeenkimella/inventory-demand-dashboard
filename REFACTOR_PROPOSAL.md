# 재고·수요 모니터링 대시보드 리팩토링 제안서

## 1) 스토리라인이 흐려지는 지점 (8개 이내)

| # | 지점 | 개선 의도 |
|---|------|-----------|
| 1 | **기준 모드가 탭별로 분리됨** (품절 위험: 실적/예측 선택, 발주·조치: 실적/예측 선택) | 전역 기준 모드(실적/예측) 한 번만 선택하면 모든 탭 KPI·캡션이 동일 레이블로 통일되도록 한다. |
| 2 | **DOS·발주 정책이 탭마다 반복 설정** (Overview: dos_basis_days, 재고 적정성: shortage_days/over_days, 품절 위험: N일 미만, 발주·조치: 리드타임/목표커버/안전재고/MOQ) | 부족·과잉 기준선 및 발주 정책을 사이드바 전역 정책 패널로 올려 한 곳에서만 설정하고, 탭에서는 제거한다. |
| 3 | **Overview가 “요약 → 이슈 → 전망 → 추이 → 비중 → TOP10”으로 나열** | “상태 → 리스크 → 조치” 3섹션으로 재구성해, 5초 안에 상태·리스크·할 일이 보이도록 한다. |
| 4 | **우선 점검 이슈가 4가지 유형·percentile 혼합** (품절 임박, 고수요·저커버, 과잉·저회전, 무수요 재고) | 단일 우선순위(예: 예상 품절일 빠른 순 + 커버리지 짧은 순)로 정렬하고, “선정 사유(1줄)” 컬럼으로 왜 이 SKU가 올랐는지 명시한다. |
| 5 | **실적/예측 문구가 탭·캡션마다 제각각** (“(예측 기준)”, “(예측 기반)”, “실적 기준(14일 평균)” 등) | 전역 기준 모드에 따라 “(실적 기준)” 또는 “(예측 기준)”만 사용하고, 캡션·KPI 라벨에 일관 적용한다. |
| 6 | **MAPE 백테스트가 N일 평균 예측과 정합하나, SeasonalNaive와는 로직 불일치** | 모델별 예측 로직과 동일한 방식으로 백테스트하거나, 신뢰도는 “데이터 충분성·무수요 비율·결측률” 등 대체 지표로 제시한다. |
| 7 | **영어 잔재** (Forecast horizon, Critical/High/Medium 등) | 모든 라벨·캡션을 한국어로 통일하고, 약어(SKU, DOS, MAPE)는 최초 1회만 풀어쓴다. |
| 8 | **발주·조치 탭에서 “추천 사유” 필터가 상세하나, Overview 우선 점검 이슈에는 “선정 이유” 없음** | 우선 점검 이슈 테이블에 “선정 사유(1줄)” 컬럼을 넣어, 사용자가 납득할 수 있게 한다. |

---

## 2) 전역 기준 모드 + 전역 정책 패널 (사이드바) 설계

### 2.1 추가할 UI (사이드바)

- **기준 모드**  
  - 라디오 또는 selectbox: `실적 기준` | `예측 기준`  
  - 선택 시 전역 변수 `basis_mode = "실적" | "예측"` 사용.  
  - 예측 기준일 때만 예측 설정(모델·학습구간·예측기간)이 의미 있음.

- **전역 정책 패널** (접이식 또는 구역 구분)  
  - **DOS 기준선**: 부족 기준(일) [7/14/21], 과잉 기준(일) [30/60/90/120]  
  - **발주 정책**: 리드타임(일), 목표 커버리지(일), 안전재고(일), 최소발주수량(MOQ)

### 2.2 적용 규칙

- 모든 KPI 카드·테이블 제목·캡션에 `basis_mode`에 따라 `(실적 기준)` 또는 `(예측 기준)` 접미.  
- 품절 위험·발주·조치 탭에서 “실적/예측 선택” UI 제거 후, `basis_mode`만 참조.  
- 재고 적정성 탭에서 shortage_days, over_days 선택 제거 → 사이드바 값 사용.  
- 발주·조치 탭에서 리드타임/목표커버/안전재고/MOQ 입력 제거 → 사이드바 값 사용.

---

## 3) Overview 탭 “상태 → 리스크 → 조치” 재배치

| 섹션 | 유지할 KPI/차트 | 다른 탭으로 이동·삭제 |
|------|-----------------|------------------------|
| **1. 상태** | 현재 재고(총 수량), 최근 N일 수요 합계, DOS 중앙값, 품절 위험 SKU 수, 과잉 SKU 수 (5카드) + DOS 풀이 캡션 1줄 | 추이 조회 기간·DOS 산정 기준 → 전역 정책으로 이동 후 탭 내 선택 제거 |
| **2. 리스크** | 우선 점검 이슈(상위 5건) 테이블 + **선정 사유(1줄)** 컬럼, “향후 N일 예상 수요”·“예측 기준 품절 위험 SKU 수” (기준 모드=예측일 때만) | 미래 전망 KPI는 “예측 기준”일 때만 표시; 수요·재고 추이 차트는 “추이” 서브섹션에 유지하되, 차트 수는 2개(수요·재고)로 유지 |
| **3. 조치** | “우선 조치 상위 10건” 테이블(예상 품절일·권장 발주수량) + “자세한 발주는 발주·조치 탭에서” 캡션 1줄 | 카테고리별 비중 → 재고 적정성 탭으로 이동 또는 Overview 하단 1개 블록으로 축소 |

정리:

- **상태**: 5개 KPI 카드 + DOS 정의 캡션.  
- **리스크**: 우선 점검 이슈(단일 우선순위 + 선정 사유) + (예측 기준일 때) 예측 KPI 2~3개.  
- **조치**: 우선 조치 TOP 10 + 발주·조치 탭 안내.  
- **추이**: 수요·재고 추이 차트(예측선/예측 구간 옵션 유지).  
- **비중**: 카테고리 비중은 재고 적정성으로 이동하거나 Overview 맨 아래 1블록.

---

## 4) Hot Issues(우선 점검 이슈) 단일 우선순위 + 선정 사유

### 4.1 단일 우선순위

- **1차 정렬**: 예상 품절일(실적: 기준일+ceil(DOS), 예측: stockout_date_forecast) 오름차순.  
- **2차 정렬**: 커버리지(DOS) 오름차순.  
- 상위 5건만 표시.

### 4.2 선정 사유(1줄) 규칙

- `예상 품절일`이 N일 이내이고 `커버리지 < 부족 기준` → `"N일 이내 품절 예상(커버리지 O일)"`  
- `커버리지 > 과잉 기준`이고 최근 30일 수요 하위 25% → `"과잉·저회전(커버리지 O일)"`  
- 최근 30일 수요 0이고 재고 > 0 → `"무수요 재고"`  
- 그 외 고수요·저커버 → `"고수요·커버리지 부족(O일)"`  
→ 이 중 **가장 위험한 하나**만 “선정 사유”로 표기 (또는 우선순위 1개 규칙에 맞춰 한 문장으로 통일).

### 4.3 테이블 컬럼 제안

- SKU, 창고, **선정 사유**, 이슈 유형(또는 제거하고 선정 사유로 통합), 심각도(한글화), 예상 품절일, 권장 발주수량.

---

## 5) MAPE 백테스트 정합 / 신뢰도 대체

### 5.1 모델 정합

- **MovingAvg(N)**: 현재와 동일하게 “전 N일 평균”으로 백테스트 유지.  
- **SeasonalNaive(N)**: 일별 예측을 “N일 전 동일 요일” 또는 “최근 N일 패턴의 (t mod N)번째 값”으로 하여 MAPE 계산하도록 수정.

### 5.2 대체 방안 (정합 어려울 때)

- **데이터 충분성**: 학습 구간 내 수요 행 수 / (SKU 수 × 일수).  
- **무수요 비율**: 최근 14일 수요 0인 SKU 비율.  
- **결측률**: 기준일 재고 스냅샷 없는 SKU 비율.  
- 위를 조합해 “신뢰도: 높음/보통/낮음” 뱃지만 표시하고, MAPE 수치는 “참고용” 캡션으로만 두거나 제거.

---

## 6) 코드 변경 diff (4개 필수 반영)

아래 4가지를 반드시 반영한 실제 코드 수정을 진행한다.

1. **사이드바 전역 설정(기준 모드 + 정책) 추가**  
2. **각 탭에서 중복 설정 제거 및 캡션 문구 통일**  
3. **Hot Issues 로직 단순화 + 선정 사유(1줄) 컬럼**  
4. **영어 문구 제거** (Forecast horizon → 예측 구간, Critical/High/Medium → 한글 등)
